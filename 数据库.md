#### 1. B树和B+树索引结构

** 注： 数据库的索引加载到内存中，海量数据存储于硬盘中，因此获取数据需于硬盘进行I/O操作

* BTree和二叉树的区别：
  * 二者的每个节点都存储（key和数据），查询数据的时候从主节点依次向下
  * `平衡二叉树`每个Node只有一个关键字和两个指向孩子的指针，而 `BTree`每个InnerNode有 k-1 个关键字  和 k 个子树, BTree是多路树。
  * `BTree`的所有叶子节点都在同一层，并且叶子节点只有关键字，指向孩子的指针为 null
  * 随着数据的增长，二叉树就会变高就会导致io变多,最终会影响查询变慢，而BTree的每个节点可以表示的信息更多，因此整个树更加“矮胖”，这在从磁盘中查找数据（先读取到内存、后查找）的过程中，可以减少磁盘 IO 的次数，从而提升查找速度。二叉树（AVL树和红黑树）基本都是存储在内存中才会使用的数据结构，

二叉树：
![ ](images/1a387844b2fc60335467a2cde4ebefac732d78f26c52e57dfb6221c5b4419573.png )  
BTree:
![图 1](images/b10053835d969dcec3e270ca3d3443da677a7863a552dcdd9778205b2a1a8ba8.png)  
B+Tree：
![图 2](images/3d8676c32b9daccc779530d940dae9b6f45070c97fcde994c6ce50113e5d3509.png)  

* BTree和B+Tree的区别
  * `B+Tree` InnerNode 仅存储key, LeafNode 存储key和数据, 所以同样大小的Page页可以容纳更多的节点元素。（这就意味着B+会更加矮胖，**查询的IO次数会更少**）, 通常就3\~4层（3\~4次IO）
  * LeafNode 还存储其右侧 LeafNode 的指针，使得LeafNode两两相连，符合磁盘的预读特性, **顺序查询和范围查询性能更高**
  * B+Tree所有查询都要查找到叶子节点，**查询性能稳定, 利于预测和优化**。
  * B+树适合范围查询和顺序访问，而B树更适合随机查询。

* 树索引对比Hash存储：
  * Hash索引时间复杂度为$O(1)$，树索引是$O(log(n))$
  * 当出现大量键重复哈希冲突，效率下降。
  * Hash无序不支持范围查询，无法用于排序分组
  * B+树的设计允许索引数据分批加载
  * 需要检索多条数据时B+的结构更有利。

